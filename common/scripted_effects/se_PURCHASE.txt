
#*************************************************
#*            The Purchase Order Plan            *
#*************************************************


#1. Wealth from pops in the governorship should all be pooled up to determine the "Purchasing Power" of the governorship for that quarter.
#	- This would be "WEALTH_governorship_total"

#2. Then sort demand by how important the trade good is.

#3. The purchase order will then be made to nearby trade zones that have an available stockpile for the goods that are in demand.

#4. Once the order is sent the movement cost between the trade zones can be factored in along with the price of the good. This will give the final price of the order.

#5. After the order is made the goods will be "moved" into the stockpile of the governorship that ordered them.

PURHCASE_make_shopping_list = {
	# Create a list of items that will need to be bought to satisfy demand this quarter
	# Scope = governorship
	every_in_list = {
		list = list_of_stockpiles
		save_scope_as = this_stockpile # The stockpile variable currently being checked
		switch = {
			trigger = this_stockpile # Get the corresponding demand svalue...
			grain_stockpile = { 
				set_variable = {
					name = this_demand
					value = DEMAND_grain
				}
			}
			mediterranean_fruit_stockpile = { 
				set_variable = {
					name = this_demand
					value = DEMAND_mediterranean_fruit
				}
			}
			glass_stockpile = { 
				set_variable = {
					name = this_demand
					value = DEMAND_glass
				}
			}
		}
		if = {
			limit = {
				var:this_demand > var:this_stockpile # Only create an order if the demand is greater than stockpile, otherwise no need to import
			}
		}
		PURHCASE_order = {
			for_stockpile = var:this_stockpile
		}
	}
}


PURHCASE_order = {
	# Every governorship does this for every deficit every quarter
	# $for_stockpile$ = the stockpile sent from the shopping list scripted effect when the PO is created
}


PURCHASE_reset_quarterly_var = {
	#Reset puchase variable every quarter for every country for every governorship
	if = {
		limit = {
			NOT = { has_variable = purchase_power }
		}
		set_variable = {
			name = purchase_power
			value = 0
		}
	}
	else = {
		remove_variable = purchase_power
		set_variable = {
			name = purchase_power
			value = 0
		}
	}
	change_variable = {
		name = purchase_power
		add = WEALTH_governorship_total
	}
}

PURCHASE_find_cheapest_stockpile = { # Find the best value stockpile based on transport costs
	#idk how to do this...
}

# Sale actions

SELL_declare_available = {
	# Scope: Governorship
	random_trade_center = { # Scope to the tradezone
		# Add to the tradezone's stockpile
		change_variable = { # TODO: set this elsewhere
			name = $goods_stockpile$ # The trade center variable will have the same name as the governorship one, for ease of transfer
			value = $amount_for_sale$ # This amount is derived from the governorship's stockpile multiplied by an svalue
		}
	}
}
	# A governorship declares how much is available for its tradezone.
	# The proportion that governorship's available stock makes up of the tradezone total is the...
	#... share of gross profit that goes back to the governorship when that stockpile is bought from

}