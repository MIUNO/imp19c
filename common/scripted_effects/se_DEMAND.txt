DEMAND_get_luxury_demand = {
	# Scope: governorship
	# Function: Count the amount of demand for the given luxury tradegood.
	# Sets a var, DEMAND_luxury_$tradegood$
	# Takes arguments:
	# Tradegood = the tradegood to calculate demand for
	set_variable = {
		name = DEMAND_luxury_$tradegood$
		value = DEMAND_luxury_base_total
	}

	if = {
		limit = {
			has_global_variable = first_time_price_setup_luxuries_done
			var:DEMAND_luxury_$tradegood$ > 0
		}
		set_local_variable = {
			name = l_$tradegood$_div_average_governorship_wealth
			value = var:price_$tradegood$
		}
		change_local_variable = {
			name = l_$tradegood$_div_average_governorship_wealth
			divide = WEALTH_governorship_per_capita # TODO: Cache this value
		}
		change_variable = {
			name = DEMAND_luxury_$tradegood$
			divide = local_var:l_$tradegood$_div_average_governorship_wealth
		}
	}
	change_variable = {
		name = DEMAND_luxury_$tradegood$
		multiply = var:DEMAND_fashionability_$tradegood$
	}

	every_governorship_state = {
		every_state_province = {
			every_pops_in_province = {
				limit = {
					culture_is_infatuated = { tradegood = $tradegood$ }
				}
				change_variable = {
					name = DEMAND_luxury_$tradegood$
					add = 0.05 # Work on scale
				}
			}
		}
	}

}

DEMAND_get_luxury_demand_all = {
	DEMAND_get_luxury_demand = { tradegood = luxury_clothing }
	DEMAND_get_luxury_demand = { tradegood = luxury_furniture }
	DEMAND_get_luxury_demand = { tradegood = spices }
	DEMAND_get_luxury_demand = { tradegood = tobacco }
	DEMAND_get_luxury_demand = { tradegood = opium }
	DEMAND_get_luxury_demand = { tradegood = sugar }
	DEMAND_get_luxury_demand = { tradegood = gems }
	DEMAND_get_luxury_demand = { tradegood = chocolate }
	DEMAND_get_luxury_demand = { tradegood = salt }
	DEMAND_get_luxury_demand = { tradegood = alcohol }
}

DEMAND_get_luxury_demand_all_first_time = {
	DEMAND_get_luxury_demand = { tradegood = luxury_clothing }
	DEMAND_get_luxury_demand = { tradegood = luxury_furniture }
	DEMAND_get_luxury_demand = { tradegood = spices }
	DEMAND_get_luxury_demand = { tradegood = tobacco }
	DEMAND_get_luxury_demand = { tradegood = opium }
	DEMAND_get_luxury_demand = { tradegood = sugar }
	DEMAND_get_luxury_demand = { tradegood = gems }
	DEMAND_get_luxury_demand = { tradegood = chocolate }
	DEMAND_get_luxury_demand = { tradegood = salt }
	DEMAND_get_luxury_demand = { tradegood = alcohol }
	set_global_variable = first_time_price_setup_food_done
}