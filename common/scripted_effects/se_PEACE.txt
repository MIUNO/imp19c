PEACE_create_peace_lists = {
	# Scope: War
	# Called: On start of war, + whenever a new tag joins war.
	# Function: Create lists for storing demands for every member of the war
	every_country = {
		limit = {
			
		}
	}

}

PEACE_register_country = {
	# Scope: Country
	# Function: register a country for a player-led peace deal, for use in WAR_scripted_guis
	save_scope_as = target_country
	$war_scope$ = {
		add_to_variable_list = {
			name = countries_registered_in_war
			target = scope:target_country
		}
	}	
	scope:target_country = {
		add_to_variable_list = {
			name = list_of_wars_in_country
			target = $war_scope$
		}
		if = {
			limit = {
				NOT = {
					any_in_list = {
						variable = war_scope_provinces

						var:war_scope = $war_scope$
					}
				}
			}
			random_province = { # Add a province to store lists and variables specific to demands relating to this country in this war
				limit = {
					NOT = {
						has_variable = war_scope_province_for
					}
				}
				save_scope_as = war_scope_province
				set_variable = {
					name = war_scope
					value = $war_scope$
				}
				set_variable = {
					name = war_scope_province_for
					value = scope:target_country
				}
			}
			add_to_variable_list = {
				name = war_scope_provinces
				target = scope:war_scope_province
			}
		}
	}
}

PEACE_toggle_request_province = {
	# Scope: country
	# Called: From WAR_scripted_guis select_province_from_defender when clicked

	# Make sure to clear it from the list first in case it's reserved by a different tag

	save_scope_as = requestor

	random_in_list = { # Add the province to the list of provinces they have claimed in the peace deal, using their war scope province (see PEACE_register_country)
		variable = war_scope_provinces
		limit = {
			var:war_scope = scope:war
		}

		save_scope_as = war_scope_prov

		if = {
			limit = {
				NOT = {
					is_target_in_variable_list = {
						name = peace_requested_provinces
						target = scope:province
					}
				}
			}
			add_to_variable_list = {
				name = peace_requested_provinces
				target = scope:province
			}
			scope:province = {
				set_variable = {
					name = PEACE_requested_by
					value = scope:requestor
				}
			}
		}
		else = {
			every_in_list = {
				variable = peace_requested_provinces
				limit = {
					THIS.province_id = scope:province.province_id
				}
				remove_from_list = peace_requested_provinces
			}
			remove_from_list = peace_requested_provinces
			scope:province = {
				remove_variable = PEACE_requested_by
			}
		}
	}
}