tradezone_setup_effect = {
	#Makes the most populated province in a trade zone a center of trade.
	#REQUIRED INPUT: TRADE_ZONE = XXX (scripted trigger name)
	random_region = {
		limit = {
			$TRADE_ZONE$ = {
				PROVINCE = no
			}
		}
		ordered_region_province = {
    		order_by = total_population
	        add_permanent_province_modifier = {
	            name = regional_center_of_trade_level_1
	        }
		}
    }
}

# Function:	Add a variable to every governorship that stores the tradezone scope, so that you can easily scope to the TZ from a governorship with minimal performance overhead whenever necessary. This front-loads the performance overhead to the start of the game and any update periods.
# Scope:	Country
# Called:	1) Whenever the governorship change effects are called (e.g. change of territory)
#			2) At the beginning of the game, to prevent any errors from missing variables referenced in svalues
# NOTE:		Actually calls several other effects that set the variables

tradezone_update_governorships = {
	every_governorships = {
		capital_scope = {
			ordered_trade_center = {
				save_scope_as = trade_center_province
				if = {
					limit = { india_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { east_north_america_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { west_north_america_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { caribbean_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { west_south_america_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { east_south_america_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { east_north_america_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { south_east_asia_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { indo_china_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { yellow_sea_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { southern_africa_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { west_africa_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { east_africa_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { middle_east_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { western_steppe_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { eastern_steppe_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { upper_yangtzi_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { atlantic_seaboard_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { central_europe_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { west_mediterranean_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { baltic_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { east_europe_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
				else_if = {
					limit = { east_mediterranean_tradezone = { PROVINCE = yes } }
					PREV.PREV = {
						set_variable = {
							name = trade_center
							value = p:trade_center_province
						}
					}
				}
			}
		}
	}
}

# Function:	Get every governorship in a specified trade zone, only used to put goverorship svalues into trade zone svalues
# Scope:	Country

stockpile_every_governorship_in_tradezone = {
    every_governorships = {
        random_governorship_state = {
        	limit = {
	             any_state_province = {
	                $TRADE_ZONE$ = { PROVINCE = yes }
	            }
        	}
            random_state_province = {
                $TRADE_ZONE$ = { PROVINCE = yes }
            }
        }
        add = $STOCKPILE$
    }
}

# Function:	Store all the necessary values as variables every quarter
# Scope:	Governorship
# Called:	1) Every quarter before doing trade
#			2) At the beginning of the game, to prevent any errors from missing variables referenced in svalues
# NOTE:		Actually calls several other effects that set the variables
TRADE_governorship_set_variables = {
	TRADE_governorships_get_pops_this_quarter = yes
}

# Function:	Store population values for a governorship in variables so that they can be referenced multiple times quickly in one quarter, rather than being re-calculated every time as a svalue
# Scope:	Governorship
# Called:	1) Every quarter before doing trade
#			2) At the beginning of the game, to prevent any errors from missing variables referenced in svalues
# NOTE:		Whenever this is called, the variables are overwritten.

TRADE_governorship_get_pops_this_quarter = {
	set_variable = {
		name = gov_total_pop_this_quarter
		value = governorship_population
	}
	set_variable = {
		name = gov_upper_strata_this_quarter
		value = governorship_upper_strata
	}
	set_variable = {
		name = gov_middle_strata_this_quarter
		value = governorship_middle_strata
	}
	set_variable = {
		name = gov_lower_strata_this_quarter
		value = governorship_lower_strata
	}
	set_variable = {
		name = gov_indentured_this_quarter
		value = governorship_indentured
	}
	set_variable = {
		name = gov_tribesmen_this_quarter
		value = governorship_tribesmen
	}
	set_variable = {
		name = gov_slaves_this_quarter
		value = governorship_slaves
	}
}