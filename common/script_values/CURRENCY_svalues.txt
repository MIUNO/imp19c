CURRENCY_base_starting_amt_circulated_thousands = {
	# Scope: Country
	# Function: Get a value proportionate to the country's economy to start off the size of their gold reserves
	value = country_population
	multiply = 1
	round = floor
}

CURRENCY_gdp_10percent = {
	value = WEALTH_total_private_moveable_wealth
	divide = 10
}

CURRENCY_debt_to_GDP_ratio = {
	value = CURRENCY_national_debt_scaled_wealth_value_millions
	divide = WEALTH_total_private_moveable_wealth_scaled
}

CURRENCY_base_starting_reserve_gold = {
	# Scope: Country
	# Function: Get a value proportionate to the country's economy to start off the size of their gold reserves
	value = country_population
	multiply = 0.1
	round = floor
}

CURRENCY_base_starting_reserve_accumulation_rate_gold = {
	# Scope: Country
	value = CURRENCY_base_starting_reserve_gold
	multiply = 0.1
	round = floor
}

CURRENCY_base_starting_reserve_silver = {
	# Scope: Country
	# Function: Get a value proportionate to the country's economy to start off the size of their silver reserves
	value = country_population
	multiply = 0.02
	round = floor
}

CURRENCY_base_starting_reserve_accumulation_rate_silver = {
	# Scope: Country
	value = CURRENCY_base_starting_reserve_silver
	multiply = 0.1
	round = floor
}

CURRENCY_wealth_value_10_units = {
	# Scope: Country
	# Function: Get the amount of wealth from minting 1,000, used when adding money to the treasury
	value = CURRENCY_wealth_value_1_unit_scaled_by_reserve_ratio
	multiply = 10
}

CURRENCY_wealth_value_1k_units = {
	# Scope: Country
	# Function: Get the amount of wealth from minting 1,000, used when adding money to the treasury
	value = CURRENCY_wealth_value_1_unit_scaled_by_reserve_ratio
	multiply = 100
}

CURRENCY_wealth_value_10k_units = {
	# Scope: Country
	# Function: Get the amount of wealth from minting 1,000, used when adding money to the treasury
	value = CURRENCY_wealth_value_1_unit_scaled_by_reserve_ratio
	multiply = 1000
}

CURRENCY_wealth_value_10_units_negative = {
	value = CURRENCY_wealth_value_1_unit
	multiply = -10
}

CURRENCY_wealth_value_1k_units_negative = {
	value = CURRENCY_wealth_value_1_unit
	multiply = -100	
}

CURRENCY_wealth_value_10k_units_negative = {
	# Scope: Country
	# Function: Get the amount of wealth from minting 1,000, used when adding money to the treasury
	value = CURRENCY_wealth_value_1_unit
	multiply = -1000
}

CURRENCY_wealth_value_1_unit = {
	# Scope: Country
	# Function: Get the amount of "wealth" units that 1 unit of this country's currency can buy according to its pegged reserve value
	if = {
		limit = {
			var:official_currency = {
				var:backing_type = flag:bimetallic_standard
			}
		}
		value = CURRENCY_wealth_value_bimetallic_from_gold
		add = CURRENCY_wealth_value_bimetallic_from_silver
	}
	else_if = {
		limit = {
			var:official_currency.var:backing_type = flag:gold_standard
		}
		value = CURRENCY_wealth_value_bimetallic_from_gold
	}
	else_if = {
		limit = {
			var:official_currency.var:backing_type = flag:silver_standard
		}
		value = CURRENCY_wealth_value_bimetallic_from_silver
	}
	else = {
		value = 999 # TEST
	}
	divide = var:official_currency.var:units_to_the_lb
}

CURRENCY_wealth_value_1_unit_scaled_by_reserve_ratio = {
	value = CURRENCY_wealth_value_1_unit
	multiply = CURRENCY_wealth_value_reserve_ratio_minting_impact
}

CURRENCY_wealth_value_1_unit_scaled_by_reserve_ratio_x1k = {
	# Function: Get the value of 1,000 units of currency, to issue £1k of national debt
	value = CURRENCY_wealth_value_1_unit_scaled_by_reserve_ratio
	multiply = 1000
}

CURRENCY_wealth_value_reserve_ratio_minting_impact = {
	value = CURRENCY_reserve_ratio_total
	divide = CURRENCY_ideal_reserve_ratio
	max = 1
}

CURRENCY_ideal_reserve_ratio_multiplier_gold = {
	# Scope: Country
	# Function: Take the reserve ACTUAL accumulation rate (never mind the target) and divide it by the total reserve size. This gives the multiplier for minting value given by the reserve ratio.
	# The ideal reserve ratio % (i.e. maximum reserve ratio size before the bonus caps out) is THIS divided by 100
	value = var:gold_reserve_actual_change
	#multiply = 10
	divide = var:gold_reserve_size
	#multiply = 30
	if = {
		limit = {
			var:official_currency.var:backing_type = flag:bimetallic_standard
		}
		multiply = CURRENCY_wealth_bimetallic_gold_as_percentage
	}
}

CURRENCY_ideal_reserve_ratio_multiplier_silver = {
	# Scope: Country
	# Function: Take the reserve ACTUAL accumulation rate (never mind the target) and divide it by the total reserve size. This gives the multiplier for minting value given by the reserve ratio.
	# The ideal reserve ratio % (i.e. maximum reserve ratio size before the bonus caps out) is THIS divided by 100
	value = var:silver_reserve_actual_change
	divide = var:silver_reserve_size
	if = {
		limit = {
			var:official_currency.var:backing_type = flag:bimetallic_standard
		}
		multiply = CURRENCY_wealth_bimetallic_silver_as_percentage
	}
}

CURRENCY_ideal_reserve_ratio = {
	# Scope: Country
	# Function: Get the ideal reserve ratio multiplier based on the metallic standard in use
	# Take the reserve ACTUAL accumulation rate (never mind the target) and divide it by the total reserve size. This gives the multiplier for minting value given by the reserve ratio.
	value = 1
	if = {
		limit = {
			var:official_currency.var:backing_type = flag:bimetallic_standard
		}
		subtract = CURRENCY_ideal_reserve_ratio_multiplier_gold
		subtract = CURRENCY_ideal_reserve_ratio_multiplier_silver
	}
	else_if = {
		limit = {
			var:official_currency.var:backing_type = flag:gold_standard
		}
		subtract = CURRENCY_ideal_reserve_ratio_multiplier_gold
	}
	else_if = {
		limit = {
			var:official_currency.var:backing_type = flag:silver_standard
		}
		subtract = CURRENCY_ideal_reserve_ratio_multiplier_silver
	}
	# The accumulation rate need only be 5% of the stockpile 
	divide = 20

	#subtract = CURRENCY_stability_impact_ideal_reserve_ratio

	min = CURRENCY_stability_impact_ideal_reserve_ratio # Minimum 0.1%
	max = 1 # Maximum 100%
}

CURRENCY_stability_impact_ideal_reserve_ratio = {
	value = 50
	if = {
		limit = {
			stability > 0
		}
		subtract = stability
		divide = 100
		min = 0.05
	}
	else = {
		value = 1
	}
}

CURRENCY_wealth_bimetallic_gold_as_percentage = {
	# Scope: Country
	# Function: Get the % of the reserve made up of gold
	value = var:gold_reserve_size
	divide = CURRENCY_wealth_bimetallic_both_reserves_size
}

CURRENCY_wealth_bimetallic_silver_as_percentage = {
	# Scope: Country
	# Function: Get the % of the reserve made up of gold
	value = var:silver_reserve_size
	divide = CURRENCY_wealth_bimetallic_both_reserves_size
}

CURRENCY_wealth_bimetallic_both_reserves_size = {
	# Scope: Country
	# Function: Add both metal reserves together
	value = var:gold_reserve_size
	add = var:silver_reserve_size
}

CURRENCY_wealth_value_bimetallic_from_gold = {
	# Scope: Country
	# Function: Get the amount of value that gold is contributing to the country's currency value
	value = var:gold_reserve_size
	divide = CURRENCY_wealth_bimetallic_both_reserves_size
	multiply = var:country_unit_price_gold
	multiply = 16 # 16 ounces to the pound, which is the base ratio
}

CURRENCY_wealth_value_bimetallic_from_silver = {
	# Scope: Country
	# Function: Get the amount of value that gold is contributing to the country's currency value
	value = var:silver_reserve_size
	divide = CURRENCY_wealth_bimetallic_both_reserves_size
	multiply = var:country_unit_price_silver
	multiply = 16 # 16 ounces to the pound, which is the base ratio
}

CURRENCY_national_debt_scaled = {
	# Scope: Country
	# Function: Take the national debt value and scale it down by a factor of 1-,000 to prevent overflows (as this goes into the billions)
	value = CURRENCY_national_debt_thousands_scaled
	add = CURRENCY_national_debt_millions_scaled
	add = CURRENCY_national_debt_billions_scaled
}

CURRENCY_national_debt_scaled_wealth_value_millions = {
	# Scope: Country
	# Function: Get the value of the national debt in millions of wealth units
	value = CURRENCY_national_debt_scaled
	multiply = CURRENCY_wealth_value_1_unit
}

CURRENCY_national_debt_thousands_scaled = {
	value = var:CURRENCY_national_debt_thousands
	divide = 100
}

CURRENCY_national_debt_millions_scaled = {
	value = var:CURRENCY_national_debt_millions
}

CURRENCY_national_debt_billions_scaled = {
	value = var:CURRENCY_national_debt_billions
	multiply = 1000
}

CURRENCY_amt_circulated_scaled = {
	# Scope: Country
	# Function: Take the amount circulated value and scale it down by a factor of 10,000 to prevent overflows (as this goes into the billions)
	value = CURRENCY_amt_circulated_thousands_scaled
	add = CURRENCY_amt_circulated_millions_scaled
	add = CURRENCY_amt_circulated_billions_scaled
}

CURRENCY_amt_circulated_thousands_scaled = {
	value = var:CURRENCY_amt_circulated_thousands
	divide = 100
}

CURRENCY_amt_circulated_millions_scaled = {
	value = var:CURRENCY_amt_circulated_millions
}

CURRENCY_amt_circulated_billions_scaled = {
	value = var:CURRENCY_amt_circulated_billions
	multiply = 100
}

CURRENCY_total_country_cash_scaled = {
	# Scope: Country
	# Function: Get the total amount of public and private cash in a country
	value = CURRENCY_national_debt_scaled
	add = CURRENCY_amt_circulated_scaled
}

CURRENCY_reserve_value_in_cash_scaled = {
	# Scope: Country
	# Function: Get the value of the country's percious metal reserves in currency units, divided by 10,000 (to scale wtih CURRENCY_total_country_cash_scaled)
	if = {
		limit = {
			var:official_currency.var:backing_type = flag:bimetallic_standard
		}
		value = CURRENCY_wealth_bimetallic_both_reserves_size
	}
	else_if = {
		limit = {
			var:official_currency.var:backing_type = flag:gold_standard
		}
		value = var:gold_reserve_size
	}
	else_if = {
		limit = {
			var:official_currency.var:backing_type = flag:silver_standard
		}
		value = var:silver_reserve_size
	}
	divide = 10000
	multiply = var:official_currency.var:units_to_the_lb
}

CURRENCY_reserve_value_in_cash_scaled_silver = {
	# Scope: Country
	# Function: Get the value of the silver reserve in cash, in the millions
	value = var:silver_reserve_size
	divide = 100
	multiply = var:official_currency.var:units_to_the_lb
	divide = 100
}

CURRENCY_reserve_value_in_wealth_silver = {
	# Scope: Country
	# Function: Get the wealth value of the silver reserve
	value = var:silver_reserve_size
	multiply = global_var:global_base_import_price_silver
}

CURRENCY_reserve_value_in_cash_scaled_gold = {
	# Scope: Country
	# Function: Get the value of the gold reserve in cash, in the millions
	value = var:gold_reserve_size
	divide = 100
	multiply = var:official_currency.var:units_to_the_lb
	divide = 100
}

CURRENCY_reserve_value_in_wealth_gold = {
	# Scope: Country
	# Function: Get the wealth value of the gold reserve
	value = var:gold_reserve_size
	multiply = global_var:global_base_import_price_gold
}

CURRENCY_reserve_ratio_total = {
	# Scope: Country
	# Function: The ratio of currency in national debt and privately held cash, against the value of the precious metal reserves
	#value = CURRENCY_reserve_value_in_cash_scaled
	value = CURRENCY_reserve_value_in_cash_scaled
	divide = CURRENCY_total_country_cash_scaled
}

CURRENCY_essentials_buying_power = {
	# Scope: Country
	# Function: Gets the effective buying power of the currency for ordinary people, based on how expensive to buy a quarter's worth of essential goods
	value = var:country_unit_price_grain
	add = var:country_unit_price_livestock
	add = var:country_unit_price_fish
	add = var:country_unit_price_vegetables
	add = var:country_unit_price_temperate_fruit
	add = var:country_unit_price_processed_foods
	add = var:country_unit_price_clothing
	add = var:country_unit_price_furniture
	add = var:country_unit_price_pharmaceuticals
	add = var:country_unit_price_alcohol

	divide = CURRENCY_wealth_value_1_unit_scaled_by_reserve_ratio
	divide = 4
}

CURRENCY_private_cash_needed = {
	# Scope: Country
	# Function: Multiply the cost of living by the country population.
	# This gives the minimum amount of cash that must be in circulation for pops to carry out day to day business. Anything less will cause serious deflation, i.e. demand for goods to drop and for a base level of shortages in every region
	value = CURRENCY_essentials_buying_power
	multiply = 4 # Multiply by 4, each pop is 4,000 people and this value will be scaled down to avoid overflows
	multiply = country_population
	divide = 1000 # Divide by 1,000 to scale down to CURRENCY_amt_circulated which is measured in the millions
}

CURRENCY_private_cash_ratio = {
	# Scope: Country
	# Function: Get the amount of private currency and divide it by the amount needed to support cost of living. If it's too low, the country will experience deflation as there is not enough money circulating
	# This also sets the demand for private cash, and will cause pops to create new cash from commerce districts independently
	# The government can set a rate at which private cash is created or recalled quarterly
	value = CURRENCY_amt_circulated_scaled_10x
	divide = CURRENCY_private_cash_needed

}

# Minting rate

CURRENCY_amt_circulated_scaled_1percent = {
	# Scope: Country
	# Function: Get 1 percent of the scaled amount of wealth circulated
	value = CURRENCY_amt_circulated_scaled
	divide = 100
}

CURRENCY_amt_circulated_scaled_10percent = {
	# Scope: Country
	# Function: Get 1 percent of the scaled amount of wealth circulated
	value = CURRENCY_amt_circulated_scaled
	divide = 10
}

CURRENCY_amt_circulated_scaled_10x = {
	# Scope: Country
	# Function: Get 1 percent of the scaled amount of wealth circulated
	value = CURRENCY_amt_circulated_scaled
	multiply = 10
}

CURRENCY_reserve_change_currency_value = {
	# Scope: Country
	# Function: Get the 1,000s value of currency in reserve change rates
	value = var:gold_reserve_actual_change
	add = var:silver_reserve_actual_change
	divide = 100
	multiply = var:official_currency.var:units_to_the_lb
	round = floor
}

CURRENCY_minting_rate_cap = {
	# Scope: Country
	# Function: Defines the maximum of new currency that can be minted every month
	# The formula is:
	# If paper money is NOT legal
	# Cap = gold_reserve_actual_change + silver_reserve_actual_change
	# + 1% of amount in circulation (for coin recycling)
	if = {
		limit = {
			var:official_currency.var:paper_money_allowed = flag:false
		}
		value = CURRENCY_reserve_change_currency_value
		add = CURRENCY_amt_circulated_scaled_10percent
		add = CURRENCY_trade_wealth_income
		round = floor
	}

	# If paper money is legal then there is no cap!
	else = {
		value = 99999
	}
}

CURRENCY_minting_rate_wealth_value = {
	# Scope: Country
	# Function: Calculates the amount of wealth created by minting coins every month
	value = var:CURRENCY_minting_rate
	multiply = CURRENCY_wealth_value_1_unit_scaled_by_reserve_ratio
	multiply = 100
}

# Private currency fluctuation due to trade

CURRENCY_trade_wealth_income = {
	# Scope: Country
	# Function: Tracks the amount of mintable coming into the country from foreign currency
	value = var:TRADE_national_income
	# We divide by the value of wealth in 1 unit of currency, as that is what we are converting when melting down foreign currency to make our own
	divide = CURRENCY_wealth_value_1_unit
	# This is quarterly income, so we divide by 4 for every month
	# Then we assume 10% of incoming foreign currency is available for melting down by minting authorities, so we divide by 10
	divide = 400
	round = floor
}

CURRENCY_trade_wealth_outgoing_currency_value = {
	# Scope: Country
	# Function: Get the amount of your currency being sent abroad in trade, which is subtracted from privately held cash every month
	value = var:TRADE_national_expenditure
	divide = CURRENCY_wealth_value_1_unit
	divide = 4
}

CURRENCY_amt_circulated_balance = {
	value = CURRENCY_trade_wealth_outgoing_currency_value
	add = var:CURRENCY_minting_rate
}

# New wealth to governorships based on minting

CURRENCY_governorship_wealth_from_minting = {
	# Scope: Governorship
	value = owner.CURRENCY_minting_rate_wealth_value
	multiply = FUNC_governorship_country_pops_ratio
}

CURRENCY_governorship_wealth_due_to_upper_strata = {
	value = CURRENCY_governorship_wealth_from_minting
	multiply = FUNC_governorship_ratio_upper_strata
	add = FUNC_governorship_ratio_slaves
	add = FUNC_governorship_ratio_indentured
}

CURRENCY_governorship_wealth_due_to_middle_strata = {
	value = CURRENCY_governorship_wealth_from_minting
	multiply = FUNC_governorship_ratio_middle_strata
}

CURRENCY_governorship_wealth_due_to_lower_strata = {
	value = CURRENCY_governorship_wealth_from_minting
	multiply = FUNC_governorship_ratio_lower_strata
}

CURRENCY_governorship_wealth_due_to_proletariat = {
	value = CURRENCY_governorship_wealth_from_minting
	multiply = FUNC_governorship_ratio_proletariat
}

CURRENCY_governorship_wealth_due_to_indentured = {
	value = CURRENCY_governorship_wealth_from_minting
	multiply = FUNC_governorship_ratio_indentured
}

CURRENCY_governorship_wealth_due_to_tribesmen = {
	value = CURRENCY_governorship_wealth_from_minting
	multiply = FUNC_governorship_ratio_tribesmen
}