# PIECHART UPDATE EVENTS
# These trigger the creation of special lists that can be referenced as datamodels by the CustomPieChart GUI widget
namespace = piechart_update

piechart_update.1 = { # Tradezone shipping power
	type = country_event # Maybe? Unless it's executed in the province scope. To be checked
	hidden = yes

	immediate = {
		if = {
			limit = {
				NOT = {
					has_global_variable = TZ_piechart_update_flag
				}
			}
			this_trade_center = { # Work on this
				save_scope_as = current_TZ
				every_country = {
					limit = {
						any_province = {
							state.governorship.var:trade_center = scope:current_TZ
						}
					}
					save_scope_as = current_country
					# Set a tracking province to be used as an item in the piechart datamodel

					# Start adding up the province shipping power
					every_owned_province = {
						limit = {
							state.governorship.var:trade_center = scope:current_TZ
							SHIPPING_province_power > 0
						}
						random_province = {
							change_variable = {
								name = shipping_power_total
								add = prev.SHIPPING_province_power
							}
						}
					}
				}
			}
			set_global_variable = {
				name = TZ_piechart_update_flag
				days = 1
			}
		}
	}
}